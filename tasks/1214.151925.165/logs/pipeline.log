2024-12-14 15:19:27,522 INFO ------------------------------------------------
2024-12-14 15:19:27,522 INFO   task id: 1214.151925.165
2024-12-14 15:19:27,522 INFO ------------------------------------------------
2024-12-14 15:19:27,522 INFO Hello Vega
2024-12-14 15:19:27,522 INFO configure: {
    "general": {
        "backend": "pytorch",
        "cluster": {}
    },
    "pipeline": [
        "nas",
        "fully_train"
    ],
    "nas": {
        "pipe_step": {
            "type": "SearchPipeStep"
        },
        "dataset": {
            "type": "Cifar10",
            "common": {
                "data_path": "/cache/datasets/cifar10/",
                "train_portion": 0.5,
                "num_workers": 8,
                "drop_last": false
            },
            "train": {
                "shuffle": true,
                "batch_size": 128
            },
            "val": {
                "batch_size": 3500
            }
        },
        "search_algorithm": {
            "type": "CARSAlgorithm",
            "policy": {
                "num_individual": 8,
                "start_ga_epoch": 50,
                "ga_interval": 10,
                "select_method": "uniform",
                "warmup": 50
            }
        },
        "search_space": {
            "type": "SearchSpace",
            "modules": [
                "super_network"
            ],
            "super_network": {
                "type": "CARSDartsNetwork",
                "stem": {
                    "type": "PreOneStem",
                    "init_channels": 16,
                    "stem_multi": 3
                },
                "head": {
                    "type": "LinearClassificationHead"
                },
                "init_channels": 16,
                "num_classes": 10,
                "auxiliary": false,
                "search": true,
                "cells": {
                    "modules": [
                        "normal",
                        "normal",
                        "reduce",
                        "normal",
                        "normal",
                        "reduce",
                        "normal",
                        "normal"
                    ],
                    "normal": {
                        "type": "NormalCell",
                        "steps": 4,
                        "genotype": [
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                2,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                2,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                3,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                3,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                3,
                                2
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                2
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                3
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                2
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                3
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                4
                            ]
                        ],
                        "concat": [
                            2,
                            3,
                            4,
                            5
                        ]
                    },
                    "reduce": {
                        "type": "ReduceCell",
                        "steps": 4,
                        "genotype": [
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                2,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                2,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                3,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                3,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                3,
                                2
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                2
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                4,
                                3
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                0
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                1
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                2
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                3
                            ],
                            [
                                [
                                    "none",
                                    "max_pool_3x3",
                                    "avg_pool_3x3",
                                    "skip_connect",
                                    "sep_conv_3x3",
                                    "sep_conv_5x5",
                                    "dil_conv_3x3",
                                    "dil_conv_5x5"
                                ],
                                5,
                                4
                            ]
                        ],
                        "concat": [
                            2,
                            3,
                            4,
                            5
                        ]
                    }
                }
            }
        },
        "trainer": {
            "type": "Trainer",
            "darts_template_file": "{default_darts_cifar10_template}",
            "callbacks": "CARSTrainerCallback",
            "epochs": 500,
            "optimizer": {
                "type": "SGD",
                "params": {
                    "lr": 0.025,
                    "momentum": 0.9,
                    "weight_decay": 0.0003
                }
            },
            "lr_scheduler": {
                "type": "CosineAnnealingLR",
                "params": {
                    "T_max": 500,
                    "eta_min": 0.001
                }
            },
            "grad_clip": 5.0,
            "seed": 10,
            "unrolled": true,
            "loss": {
                "type": "CrossEntropyLoss"
            }
        }
    },
    "fully_train": {
        "pipe_step": {
            "type": "TrainPipeStep",
            "models_folder": "{local_base_path}/output/nas/"
        },
        "trainer": {
            "ref": "nas.trainer",
            "epochs": 600,
            "lr_scheduler": {
                "type": "CosineAnnealingLR",
                "params": {
                    "T_max": 600.0,
                    "eta_min": 0
                }
            },
            "loss": {
                "type": "MixAuxiliaryLoss",
                "params": {
                    "loss_base": {
                        "type": "CrossEntropyLoss"
                    },
                    "aux_weight": 0.4
                }
            },
            "seed": 100,
            "drop_path_prob": 0.2,
            "type": "Trainer",
            "darts_template_file": "{default_darts_cifar10_template}",
            "optimizer": {
                "type": "SGD",
                "params": {
                    "lr": 0.025,
                    "momentum": 0.9,
                    "weight_decay": 0.0003
                }
            },
            "grad_clip": 5.0,
            "unrolled": true
        },
        "evaluator": {
            "type": "Evaluator",
            "host_evaluator": {
                "type": "HostEvaluator",
                "metric": {
                    "type": "accuracy"
                }
            }
        },
        "dataset": {
            "ref": "nas.dataset",
            "common": {
                "train_portion": 1.0,
                "data_path": "/cache/datasets/cifar10/",
                "num_workers": 8,
                "drop_last": false
            },
            "train": {
                "batch_size": 96,
                "shuffle": true,
                "transforms": [
                    {
                        "type": "RandomCrop",
                        "size": 32,
                        "padding": 4
                    },
                    {
                        "type": "RandomHorizontalFlip"
                    },
                    {
                        "type": "ToTensor"
                    },
                    {
                        "type": "Normalize",
                        "mean": [
                            0.49139968,
                            0.48215827,
                            0.44653124
                        ],
                        "std": [
                            0.24703233,
                            0.24348505,
                            0.26158768
                        ]
                    },
                    {
                        "type": "Cutout",
                        "length": 8
                    }
                ]
            },
            "val": {
                "batch_size": 96,
                "shuffle": false
            },
            "type": "Cifar10"
        }
    },
    "abs_path": true
}
2024-12-14 15:19:27,523 INFO ------------------------------------------------
2024-12-14 15:19:27,523 INFO End Hello Vega
2024-12-14 15:19:27,532 INFO ------------------------------------------------
2024-12-14 15:19:27,532 INFO   Step: nas
2024-12-14 15:19:27,532 INFO ------------------------------------------------
2024-12-14 15:19:27,546 INFO submit trainer, id=0
2024-12-14 15:19:27,852 INFO Model was created.
2024-12-14 15:19:30,436 INFO worker id [0], epoch [1/500], train step [  0/196], loss [   2.274,    2.274], lr [   0.0250000],  time pre batch [1.700s] , total mean time per batch [1.700s]
2024-12-14 15:20:16,156 INFO worker id [0], epoch [1/500], train step [ 10/196], loss [   2.308,    2.336], lr [   0.0250000],  time pre batch [4.571s] , total mean time per batch [4.571s]
2024-12-14 15:20:53,082 INFO worker id [0], epoch [1/500], train step [ 20/196], loss [   2.288,    2.335], lr [   0.0250000],  time pre batch [3.692s] , total mean time per batch [4.131s]
2024-12-14 15:21:21,606 INFO worker id [0], epoch [1/500], train step [ 30/196], loss [   2.156,    2.329], lr [   0.0250000],  time pre batch [2.851s] , total mean time per batch [3.705s]
2024-12-14 15:21:47,140 INFO worker id [0], epoch [1/500], train step [ 40/196], loss [   2.296,    2.341], lr [   0.0250000],  time pre batch [2.552s] , total mean time per batch [3.417s]
2024-12-14 15:22:13,276 INFO worker id [0], epoch [1/500], train step [ 50/196], loss [   2.451,    2.350], lr [   0.0250000],  time pre batch [2.613s] , total mean time per batch [3.256s]
2024-12-14 15:22:38,799 INFO worker id [0], epoch [1/500], train step [ 60/196], loss [   2.259,    2.358], lr [   0.0250000],  time pre batch [2.551s] , total mean time per batch [3.138s]
2024-12-14 15:23:08,617 INFO worker id [0], epoch [1/500], train step [ 70/196], loss [   2.307,    2.360], lr [   0.0250000],  time pre batch [2.981s] , total mean time per batch [3.116s]
2024-12-14 15:23:38,936 INFO Shutdown urgently.
2024-12-14 15:23:38,936 INFO Shutdown urgently.
2024-12-14 15:23:38,936 INFO Shutdown urgently.
2024-12-14 15:23:38,937 INFO Shutdown urgently.
2024-12-14 15:23:38,937 INFO Shutdown urgently.
2024-12-14 15:23:38,937 INFO Shutdown urgently.
2024-12-14 15:23:38,937 INFO Shutdown urgently.
2024-12-14 15:23:38,937 INFO Shutdown urgently.
2024-12-14 15:23:39,009 INFO Shutdown urgently.
